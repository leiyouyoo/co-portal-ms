<section class="im-step-content">
  <nz-steps [nzCurrent]="0" [nzStatus]="statusHighlight ? 'process' : 'wait'" nzDirection="vertical">
    <nz-step
      *ngIf="shipment?.routeDetails?.shipperDtos.length"
      [ngClass]="{
        isNotActive: !shipment?.agreement?.startsWith('door')
      }"
      [nzDescription]="description1Template"
      [nzIcon]="iconTemplate1"
    ></nz-step>
    <nz-step [nzDescription]="description2Template" [nzIcon]="iconTemplate2"></nz-step>
    <nz-step [nzDescription]="description3Template" [nzIcon]="iconTemplate3"></nz-step>
    <nz-step *ngIf="shipment?.routeDetails?.consigneeDtos.length" [nzDescription]="description4Template" [nzIcon]="iconTemplate4"></nz-step>
    <ng-template #description1Template>
      <div *ngIf="statusHighlight" class="company-name">
        <i nz-icon [nzIconfont]="'icon-kehugongsi'" class="iconfont icon-kehugongsi"></i>
        {{ getCompanyName('shipperDtos') }}
      </div>
      <nz-collapse [nzBordered]="false" nzExpandIconPosition="right">
        <nz-collapse-panel
          #shipperActive
          [nzHeader]="(shipment?.routeDetails?.shipperDtos)[0]?.customerName"
          [nzExpandedIcon]="expandedIcon1"
        >
          <div class="detail-container" *ngFor="let item of shipment?.routeDetails?.shipperDtos; let i = index">
            <div *ngIf="i > 1">{{ item.customerName }}</div>
            <div *ngFor="let addr of item.originAddresses">
              {{ [addr.streetAddress, addr.city, addr.province, addr.country] | imArrayJoin }}
            </div>
            <div>
              <div class="key">{{ 'Container' | translate }}#:</div>
              <div>{{ item.containerNos }}</div>
            </div>
            <div *ngIf="item.cargoReadyDate">
              <div class="title est-time key">{{ 'Cargo Ready Date' | translate }}:{{ item.cargoReadyDate | date: 'yyyy-MM-dd' }}</div>
            </div>
            <div>
              <span class="color-primary">{{ item.containerPickedUpCount || 0 }}</span
              >/{{ item.containerTotalCount }} {{ 'Picked Up' | translate }}
            </div>
          </div>
          <ng-template #expandedIcon1 let-active>
            <i nz-icon nzType="caret-right" class="ant-collapse-arrow" [nzRotate]="shipperActive.nzActive ? -90 : 90"></i>
          </ng-template>
        </nz-collapse-panel>
      </nz-collapse>
    </ng-template>
    <ng-template #description2Template>
      <nz-collapse [nzBordered]="false" nzExpandIconPosition="right">
        <nz-collapse-panel #originPortActive [nzHeader]="shipment?.routeDetails.originPort.name" [nzExpandedIcon]="expandedIcon2">
          <ng-template #expandedIcon2 let-active>
            <i nz-icon nzType="caret-right" class="ant-collapse-arrow" [nzRotate]="originPortActive.nzActive ? -90 : 90"></i>
          </ng-template>
          <div class="detail-container">
            <div>{{ 'Port' | translate }} {{ shipment.routeDetails?.originPort.code }}</div>
            <div *ngIf="shipment?.routeDetails?.actualTruckDeliveryOrignDate || shipment?.routeDetails?.estTruckDeliveryOrignDate">
              <div class="key">
                <ng-template [ngTemplateOutlet]="originPortArrivalText"></ng-template
                >{{
                  shipment?.routeDetails?.actualTruckDeliveryOrignDate || shipment?.routeDetails?.estTruckDeliveryOrignDate
                    | date: 'yyyy-MM-dd'
                }}
              </div>
            </div>
            <div *ngIf="shipment?.routeDetails?.actualDepatureOrginPortDate || shipment?.routeDetails?.estDepatureOrginPortDate">
              <div class="key">
                <ng-template [ngTemplateOutlet]="originPortDepartureText"></ng-template
                >{{
                  shipment?.routeDetails?.actualDepatureOrginPortDate || shipment?.routeDetails?.estDepatureOrginPortDate
                    | date: 'yyyy-MM-dd'
                }}
              </div>
            </div>
            <div>
              <div class="key">{{ 'Carrier' | translate }}:{{ shipment.routeDetails.carrierCustomerName }}</div>
            </div>
            <div>
              <span class="color-primary">{{ shipment.routeDetails.originPortDeliveredCount }}</span
              >/{{ shipment.routeDetails.containerCount }} {{ 'Delivered' | translate }}
            </div>
          </div>
        </nz-collapse-panel>
      </nz-collapse>
    </ng-template>
    <ng-template #description3Template>
      <nz-collapse [nzBordered]="false">
        <nz-collapse-panel #destPortActive [nzHeader]="shipment?.routeDetails.destinationPort.name" [nzExpandedIcon]="expandedIcon3">
          <ng-template #expandedIcon3 let-active>
            <i nz-icon nzType="caret-right" class="ant-collapse-arrow" [nzRotate]="destPortActive.nzActive ? -90 : 90"></i>
          </ng-template>
          <div class="detail-container">
            <div>{{ 'Port' | translate }} {{ shipment.routeDetails?.originPort.code }}</div>
            <div *ngIf="shipment?.routeDetails?.actualArrivalDestinationPortDate || shipment?.routeDetails?.estArrivalDestinationPortDate">
              <div class="key">
                <ng-template [ngTemplateOutlet]="destPortArrivalText"></ng-template
                >{{
                  shipment?.routeDetails?.actualArrivalDestinationPortDate || shipment?.routeDetails?.estArrivalDestinationPortDate
                    | date: 'yyyy-MM-dd'
                }}
              </div>
            </div>
            <div *ngIf="shipment?.routeDetails?.actualPickUpTruckDestinationDate || shipment?.routeDetails?.estPickUpTruckDestinationDate">
              <div class="key">
                <ng-template [ngTemplateOutlet]="destPortDepartureText"></ng-template
                >{{
                  shipment?.routeDetails?.actualPickUpTruckDestinationDate || shipment?.routeDetails?.estPickUpTruckDestinationDate
                    | date: 'yyyy-MM-dd'
                }}
              </div>
            </div>
            <div *ngIf="shipment.routeDetails.truckCustomerName">
              <div class="key">{{ 'Trucker' | translate }}:</div>
              <div>{{ shipment.routeDetails.truckCustomerName }}</div>
            </div>
            <div>
              <span class="color-primary">{{ shipment.routeDetails.destinationPortPickedUpCount }}</span
              >/{{ shipment.routeDetails.containerCount }} {{ 'Picked up' | translate }}
            </div>
          </div>
        </nz-collapse-panel>
      </nz-collapse>
    </ng-template>
    <ng-template #description4Template>
      <div *ngIf="statusHighlight" class="company-name">
        <i nz-icon [nzIconfont]="'icon-kehugongsi'" class="iconfont icon-kehugongsi"></i>
        {{ getCompanyName('consigneeDtos') }}
      </div>
      <nz-collapse [nzBordered]="false">
        <nz-collapse-panel
          #destDeliveryActive
          [nzHeader]="(shipment?.routeDetails?.consigneeDtos)[0]?.customerName"
          [nzExpandedIcon]="expandedIcon4"
        >
          <ng-template #expandedIcon4 let-active>
            <i nz-icon nzType="caret-right" class="ant-collapse-arrow" [nzRotate]="destDeliveryActive.nzActive ? -90 : 90"></i>
          </ng-template>
          <div class="detail-container" *ngFor="let item of shipment?.routeDetails?.consigneeDtos; let i = index">
            <div *ngIf="i > 1">{{ item.customerName }}</div>
            <div *ngFor="let addr of item.destinationAddresses">
              {{ [addr.streetAddress, addr.city, addr.province, addr.country] | imArrayJoin }}
            </div>
            <div>
              <div class="key">{{ 'Container' | translate }}#:</div>
              <div>{{ item.containerNos }}</div>
            </div>
            <div *ngIf="item.actualTruckDeliveryDate || item.estTruckDeliveryDate">
              <div class="title est-time key">
                <ng-template [ngTemplateOutlet]="destDeliveryText"></ng-template>
                {{ item.actualTruckDeliveryDate || item.estTruckDeliveryDate | date: 'yyyy-MM-dd' }}
              </div>
            </div>
            <div>
              <span class="color-primary">{{ item.containerDeliveredCount || 0 }}</span
              >/{{ item.containerTotalCount }} {{ 'Delivered' | translate }}
            </div>
          </div>
        </nz-collapse-panel>
      </nz-collapse>
    </ng-template>
  </nz-steps>
</section>

<ng-template #cargoReadyDateText>
  Cargo Ready Date:
</ng-template>
<ng-template #originPortArrivalText>
  {{ (!shipment?.routeDetails?.actualTruckDeliveryOrignDate ? 'Est.Arrival' : 'Arrived') | translate }}:
</ng-template>
<ng-template #originPortDepartureText>
  {{ (!shipment?.routeDetails?.actualDepatureOrginPortDate ? 'Est.Departure' : 'Departed') | translate }}:
</ng-template>
<ng-template #destPortArrivalText>
  {{ (!shipment?.routeDetails?.actualArrivalDestinationPortDate ? 'Est.Arrival' : 'Arrived') | translate }}:
</ng-template>
<ng-template #destPortDepartureText>
  {{ (!shipment?.routeDetails?.actualPickUpTruckDestinationDate ? 'Est.Pick-Up' : 'Picked Up in Full') | translate }}:
</ng-template>
<ng-template #destDeliveryText>
  {{ (shipment.status < ShipmentStatusEnum.DestinationStopOff ? 'Est.Delivery' : 'Delivery in Full') | translate }}:
</ng-template>

<!-- 图标template -->
<ng-template #iconTemplate1><i nz-icon [nzIconfont]="'icon-kehugongsi'" class="iconfont icon-locationim font20"></i></ng-template>
<ng-template #iconTemplate2>
  <i
    class="iconfont icon-portim font20"
    nz-icon
    [nzIconfont]="'icon-portim'"
    *ngIf="freightMethodType[shipment.freightMethodType] === 'Ocean'"
  ></i>
  <i
    class="iconfont icon-portim font20"
    nz-icon
    [nzIconfont]="'icon-portim'"
    *ngIf="freightMethodType[shipment.freightMethodType] === 'Air'"
  ></i>
</ng-template>
<ng-template #iconTemplate3>
  <i
    class="iconfont icon-portim font20"
    nz-icon
    [nzIconfont]="'icon-portim'"
    *ngIf="freightMethodType[shipment.freightMethodType] === 'Ocean'"
  ></i>
  <i
    class="iconfont icon-portim font20"
    nz-icon
    [nzIconfont]="'icon-portim'"
    *ngIf="freightMethodType[shipment.freightMethodType] === 'Air'"
  ></i>
</ng-template>
<ng-template #iconTemplate4><i class="iconfont icon-locationim font20" nz-icon [nzIconfont]="'icon-locationim'"></i></ng-template>
